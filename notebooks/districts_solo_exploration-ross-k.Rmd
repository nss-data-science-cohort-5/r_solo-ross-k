---
title: "districts_solo_exploration-ross-k"
output: html_notebook
---

```{r}
library(dplyr)
library(ggplot2)
library(tidyverse)
```
```{r}
districts = read_csv('../data/districts.csv')
spec(districts)
```

```{r}
# 1) Clean and explore data using tidyverse verbs, e.g. arrange, filter, mutate, and select.
```

```{r}
districts
```
```{r}
# is.na(districts)
```

```{r}
districts %>% 
  select(system_name, enrollment, expenditures) %>%
  arrange(desc(enrollment))
```
```{r}
districts %>% 
  select(system_name, expenditures, enrollment) %>%
  arrange(desc(expenditures))
```
```{r}
districts %>% 
  select(system_name, chronic_abs) %>%
  arrange(desc(chronic_abs))
```
```{r}
districts %>% 
  select(system_name, suspended) %>%
  arrange(desc(suspended))
```


```{r}
# 2) Calculate descriptive statistics, including finding aggregate values by group.

# TRY select(where(...) & !...) - SEE 11/18 correlation_and_linear_regression

regional_spending <- districts %>% 
  group_by(region, system_name) %>% 
  summarize(median_reg_spending = median(expenditures))

regional_act <- districts %>% 
  group_by(region, system_name) %>% 
  summarize(median_reg_act = median(act_composite),
            max_reg_act = max(act_composite)) 

regional_grad <- districts %>% 
  group_by(region, system_name) %>% 
  summarize(mean_reg_grad = mean(grad)) 

regional_enrollment <- districts %>% 
  group_by(region, system_name) %>% 
  summarize(max_reg_enrollment = max(enrollment))
```

```{r}
districts %>%
  slice_max(black)
```


```{r}
districts %>%
  slice_max(hispanic)
```


```{r}
districts %>%
  slice_max(native)
```


```{r}
# 3) Create visualizations using the ggplot library.

# FROM 11/16/2021 aggregations_demo:
districts %>% 
  ggplot(aes(x = expenditures)) +
  geom_histogram(bins = 100,
                 fill = 'blue', 
                 color = 'black') +
  # labs(title = 'Distribution of Body Mass by Species', x = 'Body Mass (g)') +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
ggplot(regional_act,
       aes(x = median_reg_act,
           color = region)) +
  geom_bar()
```

```{r}
ggplot(regional_grad,
       aes(x = region,
           y = mean_reg_grad,
           color = region)) +
  geom_point()
```
```{r}
ggplot(regional_enrollment,
       aes(x = region,
           y = max_reg_enrollment,
           color = region)) +
  geom_point()
```
```{r}
ggplot(regional_spending,
       aes(x = region,
           y = median_reg_spending,
           color = region)) +
  geom_point() +
  expand_limits(y = 0)
```
```{r}
# 4) Calculate correlations and fit a linear regression model using the 'lm' function.

dists_cor <- districts %>% 
  select(where(is.numeric)) %>%
  cor(use = 'pairwise.complete.obs') %>%
  as_tibble()
```

```{r}
dists_obj
```

```{r}
simple_reg <- lm(math ~ ela,
                 data = districts)
summary(simple_reg)
```

```{r}
predict(simple_reg, 
        newdata = districts)
```

```{r}
districts %>%
  mutate(prediction = predict(simple_reg, 
                              newdata = districts)) %>%
  ggplot(aes(x = ela,
             y = math)) +
      geom_point() +
      geom_line(aes(x = ela,
                    y = prediction))
```

```{r}
predict(simple_reg, 
        districts, 
        interval = c('confidence'), 
        level = 0.95) %>% 
  head()
```

```{r}
districts %>% 
  cbind(predict(simple_reg, 
                districts, 
                interval = c('confidence'), 
                level = 0.95)) %>% 
  ggplot(aes(x = ela, 
             y = math)) + 
  geom_point() +
  geom_line(aes(x = ela, 
                y = fit)) +
  geom_ribbon(aes(ymin = lwr, 
                  ymax = upr), 
              fill = 'cornflowerblue', 
              alpha = 0.4)
```

